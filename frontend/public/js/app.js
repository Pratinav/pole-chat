"use strict";function getTime(){var e=new Date,t=e.getHours(),n=e.getMinutes();return t<10&&(t="0"+t),n<10&&(n="0"+n),t+":"+n}function scrollDown(){window.scrollTo(0,document.body.scrollHeight)}window.onload=function(){function e(e){e.preventDefault(),x=g.value.trim(),m.emit("login",x)}function t(){var t=this;N.push(x),u(N.length);var n=document.querySelector(".me");n.appendChild(document.createTextNode(x)),n.style.display="block",h.addEventListener("transitionend",function(e){h.parentNode.removeChild(h),h.removeEventListener("transitionend",t)}),h.classList.add("login__wrapper--disabled"),y.removeEventListener("submit",e)}function n(){"block"===b.style.display&&(b.style.display="none"),"none"!==f.style.display&&f.style.display||(f.style.display="block")}function i(){"block"===f.style.display&&(f.style.display="none"),"none"!==b.style.display&&b.style.display||(b.style.display="block")}function d(e){var t=this;A=!0,N=e,u(N.length),N.forEach(function(e){var t=document.createElement("div");t.setAttribute("data-user",e);var n=document.createTextNode(e);t.appendChild(n),C.appendChild(t)}),v.addEventListener("transitionend",function(e){v.parentNode.removeChild(v),v.removeEventListener("transitionend",t)}),v.classList.add("spinner__container--disabled")}function a(e){var t=e.keyCode;9!==t&&13!==t&&(t>=16&&t<=45||t>=91&&t<=93||t>=112&&t<=145||(k||(k=!0,m.emit("started typing",x)),_&&clearTimeout(_),_=setTimeout(function(){k=!1,m.emit("ended typing",x)},2e3)))}function o(e){var t=document.createElement("div");t.classList.add("bubble"),t.classList.add("typing-indicator"),t.innerHTML="<span></span><span></span><span></span>";var n=E.querySelectorAll("li");if(n=n[n.length-1],n&&n.getAttribute("data-user")===e)return void n.appendChild(t);var i=document.createElement("li");i.setAttribute("data-user",e),i.setAttribute("data-typing","true");var d=document.createElement("span");d.classList.add("name"),d.appendChild(document.createTextNode(e)),i.appendChild(d),i.appendChild(t),E.appendChild(i)}function l(e){var t=document.querySelectorAll('li[data-user="'+e+'"]');if(t=t[t.length-1],t.hasAttribute("data-typing"))return void E.removeChild(t);var n=t.lastChild;t.removeChild(n)}function r(e){e.preventDefault();var t=T.value.trim();t&&(k&&(clearTimeout(_),k=!1,m.emit("ended typing",x)),c(t,x,new Date),m.emit("chat message",t,x),T.value="")}function s(e){var t=N.indexOf(e),n=t>-1,i=document.createElement("li");i.classList.add("notice");var d=document.createElement("span");if(d.classList.add("user"),d.appendChild(document.createTextNode(e)),i.appendChild(d),i.appendChild(document.createTextNode(" "+(n?"disconnected":"connected"))),E.appendChild(i),scrollDown(),n)C.removeChild(C.querySelector('div[data-user="'+e+'"]')),N.splice(t,1);else{var a=document.createElement("div");a.setAttribute("data-user",e),a.appendChild(document.createTextNode(e)),C.appendChild(a),N.push(e)}u(N.length)}function c(e,t){D&&(document.title="Pole Chat ("+ ++H+")");var n=getTime(),i=document.createElement("div");i.classList.add("bubble"),i.setAttribute("data-time",n),i.appendChild(document.createTextNode(e));var d=void 0,a=E.querySelectorAll("li");if(a=a[a.length-1],a&&a.getAttribute("data-user")===t){var o=a.querySelectorAll(".bubble");if(o=o[o.length-1],o.getAttribute("data-time")===n){var l=document.createElement("br");a.insertBefore(l,o.nextSibling),a.insertBefore(i,l.nextSibling)}else d=document.createElement("span"),d.classList.add("time"),d.appendChild(document.createTextNode(n)),a.appendChild(i),a.appendChild(d)}else{var r=document.createElement("li");if(r.setAttribute("data-user",t),t===x)r.classList.add("mine");else{var s=document.createElement("span");s.classList.add("name"),s.appendChild(document.createTextNode(t)),r.appendChild(s)}d=document.createElement("span"),d.classList.add("time"),d.appendChild(document.createTextNode(n)),r.appendChild(i),r.appendChild(d),E.appendChild(r)}scrollDown()}function u(e){return 0===e?(L[0].innerHTML="No Users Online",void(L[1].innerHTML="No Users Online")):(L[0].innerHTML="View "+e+" User"+(N.length>1?"s":""),void(L[1].innerHTML=e+" User"+(N.length>1?"s":"")+" Online"))}function p(){C.classList.toggle("users-online--visible")}var m=io("https://pole-chat.herokuapp.com/"),v=document.querySelector(".spinner__container"),h=document.querySelector(".login__wrapper"),y=document.querySelector(".login"),g=document.querySelector(".login-input"),f=document.querySelector(".username-invalid"),b=document.querySelector(".username-taken"),C=document.querySelector(".users-online"),L=document.querySelectorAll(".user-no"),E=document.querySelector(".chatbox"),S=document.querySelector(".send-msg form"),T=document.querySelector(".msg"),q=document.querySelector(".pull"),w=document.querySelector(".close"),A=!1,x=void 0,N=void 0,k=!1,_=void 0,D=!1,H=0;y.addEventListener("submit",e),S.addEventListener("submit",r),q.addEventListener("click",p),w.addEventListener("click",p),T.onkeydown=a,window.onblur=function(e){D=!0},window.onfocus=function(e){D=!1,H=0,document.title="Pole Chat"},m.on("init",d),m.on("invalid username",n),m.on("username taken",i),m.on("login successfull",t),m.on("joined",s),m.on("disconnect",s),m.on("chat message",c),m.on("started typing",o),m.on("ended typing",l)};